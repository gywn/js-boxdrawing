var Caret=Caret?Caret:{};(function(c){var b=function(e){return e!=undefined};var d=function(e,f){if(b(e.val)){e.val(f)}else{if(b(e.value)){e.value=f}else{if(b(e.textContent)){e.textContent=f}else{return false}}}return true};var a=function(e){if(b(e.val)){return e.val()}else{if(b(e.value)){return e.value}else{if(b(e.textContent)){return e.textContent}else{return null}}}};c.side=function(g,f){var e=[[0,-1],[-1,0],[0,1],[1,0],[0,0]];return{row:g.row+e[f][0],col:g.col+e[f][1]}};c.get=function(h,j){var i=j.row;var g=j.col;var f=a(h).split("\n");var e=f[i]?f[i]:"";return i<0||i>=f.length||g<0||g>=e.length?" ":e[g]};c.ENLARGE=0;c.NO_FOCUS=1;c.set=function(j,m,i,h){var k=m.row;var g=m.col;var f=a(j).split("\n");if(k<0||g<0){return}while(k>=f.length){f.push("")}var e=f[k];if(g>=e.length){e+=Array(g-e.length+2).join(" ")}f[k]=h==c.ENLARGE?e:e.substring(0,g)+i[0]+e.substring(g+1);var m=c.getCaret(j);d(j,f.join("\n"));if(h!=c.NO_FOCUS){c.setCaret(j,m)}return i};c.getCaret=function(h){var f=h instanceof jQuery?h[0]:h;var j={};if("selectionStart" in f){j={start:f.selectionStart,end:f.selectionEnd}}else{if("selection" in document){var g=f.value.replace(/\r\n/g,"\n");var k=document.selection.createRange().duplicate();k.moveEnd("character",g.length);var e=(k.text==""?g.length:g.lastIndexOf(k.text));k=document.selection.createRange().duplicate();k.moveStart("character",-g.length);var i=k.text.length;j={start:e,end:i}}else{j={start:undefined,end:undefined}}}var l=a(h);var m=function(n){return{row:(l.substr(0,n).match(/\n/g)||[]).length,col:n-1-l.substr(0,n).lastIndexOf("\n")}};return{start:m(j.start),end:m(j.end)}};c.setCaret=function(g,k){var l=a(g);var m=l.split("\n");var i=function(o){var n=o.row;var p=o.col;return(m.slice(0,n).join("")+(m[n]?m[n]:"").substr(0,p)).length+n};var e=i(k.start);var h=i(k.end);var f=g instanceof jQuery?g[0]:g;if("selectionStart" in f){f.selectionStart=e;f.selectionEnd=h}else{if("selection" in document){l=l.replace(/\r\n/g,"\n");var j=f.createTextRange();j.collapse(true);j.moveStart("character",e);j.moveEnd("character",h-e);j.select()}else{e=undefined;h=undefined}}return true}})(Caret);var Keys=Keys?Keys:{};(function(a){var c=function(d){return d>36&&d<41};var b=function(d){return d==13||d==32||d>47&&d<112||d>145&&d<229};a.DIR={which:c,metaKey:false,shiftKey:false,ctrlKey:false,altKey:false};a.SHIFT_DIR={which:c,metaKey:false,shiftKey:true,ctrlKey:false,altKey:false};a.META_SHIFT_DIR={which:c,metaKey:true,shiftKey:true,ctrlKey:false,altKey:false};a.META_SHIFT_BS={which:8,metaKey:true,shiftKey:true,ctrlKey:false,altKey:false};a.ALT={which:18,metaKey:false,shiftKey:false,ctrlKey:false,altKey:true};a.TAB={which:9,metaKey:false,shiftKey:false,ctrlKey:false,altKey:false};a.META_SHIFT={metaKey:true,shiftKey:true,ctrlKey:false,altKey:false};a.META_Z={which:90,metaKey:true,shiftKey:false,ctrlKey:false,altKey:false};a.META_V={which:86,metaKey:true,shiftKey:false,ctrlKey:false,altKey:false};a.META_SHIFT_Z={which:90,metaKey:true,shiftKey:true,ctrlKey:false,altKey:false};a.BACKSPACE={which:8,metaKey:false,shiftKey:false,ctrlKey:false,altKey:false};a.NON_FUNC={which:b,metaKey:false,ctrlKey:false,altKey:false};a.equal=function(e,g){if(!g){return false}var i=true;for(var d in g){var f=e[d];var h=g[d];i=i&&f!=undefined&&(f==h||$.isFunction(h)&&h(f))}return i}})(Keys);var UI=UI?UI:{};(function(a){a.t={};a.LAST_CTRL=-1;a.groupInit=function(h,f,c,b){a[h]={};a[h].ctrl=function(j){return $("#"+f+"-"+j)};a[h].variable=c;for(var e in b){var i=b[e];var d=a[h].ctrl(e);if(!d){continue}for(var g in i){d.attr(g,i[g])}d.attr("group",h);d.click(function(j){var l=$(j.target);var n=l.attr("group");var k=l.attr("next");var m=a[n];m.previous=m.current;m.current=l;m.next=k==a.LAST_CTRL?m.previous:m.ctrl(k);m.variable.val=parseInt(l.attr("val"));$(".selected-"+n).toggleClass("selected-"+n);l.addClass("selected-"+n);a.t[n]=l.attr("t");$.isFunction(a.updateStyle)&&a.updateStyle();a.t.focus()})}}})(UI);var History=History?History:{};(function(b,c){var a={};var d=-1;a.update=function(f,e){if(!e){a.stack.length=(++d)}a.stack[d]=f;if(window.localStorage){window.localStorage.setItem("history",JSON.stringify(a.current()))}};a.current=function(){var e=a.stack[d];if(e){return e}else{if(d>=a.stack.length){d=a.stack.length-1}if(d<0){d=0}return false}};b.init=function(){if(window.localStorage){var h=window.localStorage.getItem("history");try{var f=[$.parseJSON(h)]}catch(g){var f=[]}}a.stack=(f[0]&&f[0].text)?f:[{text:"",caret:{start:{row:0,col:0},end:{row:0,col:0}}}];d=0;return true};b.record=function(e){var h=e.val();var g=c.getCaret(e);var f=a.current();if(h.replace(/\s*\n|[\s]*$/g,"")==f.text.replace(/\s*\n|[\s]*$/g,"")){a.update({text:h,caret:g},true)}else{a.update({text:h,caret:g},false)}};b.resume=function(e){if(a.current()){e.val(a.current().text);c.setCaret(e,a.current().caret)}};b.rewind=function(e){d--;b.resume(e);return false};b.redo=function(e){d++;b.resume(e);return false}})(History,Caret);var Draw=Draw?Draw:{};(function(b,c,d){b.NOTHING=-1;b.BLANK=0;b.REGULAR=1;b.BOLD=2;b.DOUBLE=3;b.PLAIN=0;b.ROUND=1;b.DASHED=2;b.NO_ARROW=0;b.ARROW=1;b.style={val:b.REGULAR};b.heart={val:b.ROUND};b.arrow={val:b.NO_ARROW};b.move=function(j,o){var i={};var n=c.getCaret(j);if(n.start.row!=n.end.row||n.start.col!=n.end.col-1){return true}if(n.start.col==0&&o==0||n.start.row==0&&o==1){return false}var g={};g.start=c.side(n.start,o);g.end=c.side(n.end,o);var m=[2,3,0,1];var h=e(j,n.start,o,b.style.val);var l=a(h,m[o]);var k=Draw.BestArrow[m[o]][Draw.style.val];var f=e(j,g.start,m[o],b.style.val);if(b.arrow.val==b.ARROW&&l==b.style.val){c.set(j,n.start,k);d.arrow.next.click()}else{c.set(j,n.start,h);c.set(j,g.start,f)}c.setCaret(j,g);return false};var a=function(h,g){var f=b.GlyphEndType[h];return f?parseInt(f[g]):b.BLANK};var e=function(k,p,g,f){var t=p.row;var j=p.col;var n=[2,3,0,1];var q=[];for(var l=0;l<4;l++){q[l]=g==l?f:a(c.get(k,c.side(p,l)),n[l])}var r=b.StyleCount;var m=b.HeartCount;var o=b.BestGlyph[4*Math.pow(r,4)*b.heart.val+Math.pow(r,4)*g+Math.pow(r,3)*q[0]+Math.pow(r,2)*q[1]+r*q[2]+q[3]];return o?o:" "};b.backspace=function(g){var h=c.getCaret(g);if(h.start.row!=h.end.row){return true}else{if(h.start.col!=0&&h.start.col==h.end.col){h.start=c.side(h.start,0)}}var f=h.start;while(f.col<h.end.col){c.set(g,f," ");f=c.side(f,2)}h.end=h.start;c.setCaret(g,h);return false};b.extendArea=function(f,g){var h=c.getCaret(f);var i={};i.start=c.side(h.start,g);i.end=c.side(h.end,g);c.set(f,i.end," ",c.ENLARGE)}})(Draw,Caret,UI);Draw.HeartCount=3;Draw.StyleCount=4;Draw.GlyphEndType={" ":"0000","╴":"1000","╸":"2000","╵":"0100","╹":"0200","╶":"0010","╺":"0020","╷":"0001","╻":"0002","┘":"1100","╯":"1100","┛":"2200","┙":"2100","┚":"1200","─":"1010","┄":"1010","►":"1000","◄":"0010","━":"2020","┅":"2020","▶":"2000","◀":"0020","╾":"2010","╼":"1020","┐":"1001","╮":"1001","┓":"2002","┑":"2001","┒":"1002","└":"0110","╰":"0110","┗":"0220","┖":"0210","┕":"0120","│":"0101","┊":"0101","⍒":"0100","⍋":"0001","┃":"0202","┋":"0202","▼":"0200","▲":"0002","╿":"0201","╽":"0102","┌":"0011","╭":"0011","┏":"0022","┍":"0021","┎":"0012","┴":"1110","┻":"2220","┵":"2110","┸":"1210","┶":"1120","┺":"1220","┷":"2120","┹":"2210","┤":"1101","┫":"2202","┥":"2101","┦":"1201","┧":"1102","┨":"1202","┪":"2102","┩":"2201","┬":"1011","┳":"2022","┭":"2011","┮":"1021","┰":"1012","┲":"1022","┱":"2012","┯":"2021","├":"0111","┣":"0222","┞":"0211","┝":"0121","┟":"0112","┢":"0122","┠":"0212","┡":"0221","┼":"1111","╋":"2222","┽":"2111","╀":"1211","┾":"1121","╁":"1112","╊":"1222","╈":"2122","╉":"2212","╇":"2221","╂":"1212","┿":"2121","╃":"2211","╄":"1221","╆":"1122","╅":"2112","═":"3030","▷":"3000","◁":"0030","║":"0303","▽":"0300","△":"0003","╝":"3300","╚":"0330","╔":"0033","╗":"3003","╜":"1300","╘":"0130","╓":"0013","╕":"3001","╛":"3100","╙":"0310","╒":"0031","╖":"1003","╩":"3330","╠":"0333","╦":"3033","╣":"3303","╨":"1310","╞":"0131","╥":"1013","╡":"3101","╧":"3130","╟":"0313","╤":"3031","╢":"1303","╬":"3333","╪":"3131","╫":"1313"};Draw.BestGlyph=" ╷╻╷╶┌┎╓╺┍┏┏╶╒┏╔╵│╽│└├┟├┕┝┢┝╘╞┟╠╹╿┃┃┖┞┠┞┗┡┣┣┗┞┣╠╵│┃║╙├┟╟┗┝┣╠╚╠╠╠╴┐┒╖─┬┰╥╼┮┲┮─┬┰╥┘┤┧┤┴┼╁┼┶┾╆┾┴┼╁┼┚┦┨┦┸╀╂╀┺╄╊╊┸╀╊╀╜┤┧╢╨┼╁╫┶┾╊╫╨┼╁╫╸┑┓┓╾┭┱┭━┯┳┳━┭┳┳┙┥┪┥┵┽╅┽┷┿╈╈┵┽╈┽┛┩┫┫┹╃╉╉┻╇╋╋┻╇╋╋┛┥┫┫┵┽╉┽┻╇╋╋┻┽╋╋▷╕╗╗═╤╦╦═╤╦╦═╤╦╦╛╡╡╣╧╪╪╬╧╪╪╬╧╪╪╬╝╡╣╣╩╪╬╬╩╪╬╬╩╪╬╬╝╣╣╣╩╬╬╬╩╬╬╬╩╬╬╬ ╷╻╷╶┌┎╓╺┍┏┏╶╒┏╔╵│╽│└├┟├┕┝┢┝╘╞┟╞╹╿┃┃┖┞┠┞┗┡┣┣┗┞┣┣▽║║║╙╟╟╟╚╠╠╠╚╠╠╠╴┐┒╖─┬┰╥╼┮┲┮─┬┰╦┘┤┧┤┴┼╁┼┶┾╆┾┴┼╁┼┚┦┨┦┸╀╂╀┺╄╊╊┸╀╊╀╜╢╢╢╨╫╫╫╨╫╫╫╩╬╬╬╸┑┓┓╾┭┱┭━┯┳┳━┭┳╦┙┥┪┥┵┽╅┽┷┿╈╈┵┽╈┽┛┩┫┫┹╃╉╉┻╇╋╋┻╇╋╋╝╣╣╣╨╫╫╫╩╬╬╬╩╬╬╬╴╕┓╗─┬┰╦━┮┳╦═╤╦╦╛╡┧╡┴┼╁┼┶┾╈┾╧╪╪╪┛┦┫┫┸╀╉╀┻╇╋╋┻╀╋╋╝╣╣╣╩╬╬╬╩╬╬╬╩╬╬╬ ╷╻╷╶┌┎╓╺┍┏┏◁╒╔╔╵│╽│└├┟├┕┝┢┝╘╞╞╠╹╿┃┃┖┞┠┞┗┡┣┣╚╞╠╠╵│┃║╙├┟╟┗┝┣┣╚╠╠╠╴┐┒╖─┬┰╥╼┮┲┮═╤╦╦┘┤┧┤┴┼╁┼┶┾╆┾╧╪╪╬┚┦┨┦┸╀╂╀┺╄╊╊╩╪╬╬╜┤┧╢╨┼╁╫┶┾╊┾╩╬╬╬╸┑┓┓╾┭┱┭━┯┳┳═╤╦╦┙┥┪┥┵┽╅┽┷┿╈╈╧╪╪╬┛┩┫┫┹╃╉╉┻╇╋╋╩╪╬╬┛┥┫╣┵┽╉╫┻╇╋╋╩╬╬╬╴╕┓╗─┬┰╥━┮┳┳═╤╦╦╛╡┧╣┴┼╁┼┶┾╈┾╧╪╪╬┛┦┫╣┸╀╉╀┻╇╋╋╩╪╬╬╝╣╣╣╨┼╁╫┻┾╋╋╩╬╬╬ ╷╻△╶┌┎╓╺┍┏╔╶╒┏╔╵│╽║└├┟╟┕┝┢╠╘╞┟╠╹╿┃║┖┞┠╟┗┡┣╠┗┞┣╠╵│┃║╙├┟╟┗┝┣╠╚╞┣╠╴┐┒╖─┬┰╥╼┮┲╥─┬┰╦┘┤┧╢┴┼╁╫┶┾╆╫┴┼╁╬┚┦┨╢┸╀╂╫┺╄╊╫┸╀╊╬╜┤┧╢╨┼╁╫┶┾╊╫╩┼╁╬╸┑┓╗╾┭┱╥━┯┳╦━┭┳╦┙┥┪╣┵┽╅╫┷┿╈╬┵┽╈╬┛┩┫╣┹╃╉╫┻╇╋╬┻╇╋╬┛┥┫╣┵┽╉╫┻╇╋╬╩┽╋╬╴╕┓╗─┬┰╦━┮┳╦═╤┳╦╛╡┧╣┴┼╁╬┶┾╈╬╧╪╁╬┛┦┫╣┸╀╉╬┻╇╋╬╩╪╋╬╝╡┫╣╩┼╁╬╩┾╋╬╩╪╋╬ ╷╻╷╶╭┎╓╺┍┏┏╶╒┏╔╵│╽│╰├┟├┕┝┢┝╘╞┟╠╹╿┃┃┖┞┠┞┗┡┣┣┗┞┣╠╵│┃║╙├┟╟┗┝┣╠╚╠╠╠╴╮┒╖─┬┰╥╼┮┲┮─┬┰╥╯┤┧┤┴┼╁┼┶┾╆┾┴┼╁┼┚┦┨┦┸╀╂╀┺╄╊╊┸╀╊╀╜┤┧╢╨┼╁╫┶┾╊╫╨┼╁╫╸┑┓┓╾┭┱┭━┯┳┳━┭┳┳┙┥┪┥┵┽╅┽┷┿╈╈┵┽╈┽┛┩┫┫┹╃╉╉┻╇╋╋┻╇╋╋┛┥┫┫┵┽╉┽┻╇╋╋┻┽╋╋▷╕╗╗═╤╦╦═╤╦╦═╤╦╦╛╡╡╣╧╪╪╬╧╪╪╬╧╪╪╬╝╡╣╣╩╪╬╬╩╪╬╬╩╪╬╬╝╣╣╣╩╬╬╬╩╬╬╬╩╬╬╬ ╷╻╷╶╭┎╓╺┍┏┏╶╒┏╔╵│╽│╰├┟├┕┝┢┝╘╞┟╞╹╿┃┃┖┞┠┞┗┡┣┣┗┞┣┣▽║║║╙╟╟╟╚╠╠╠╚╠╠╠╴╮┒╖─┬┰╥╼┮┲┮─┬┰╦╯┤┧┤┴┼╁┼┶┾╆┾┴┼╁┼┚┦┨┦┸╀╂╀┺╄╊╊┸╀╊╀╜╢╢╢╨╫╫╫╨╫╫╫╩╬╬╬╸┑┓┓╾┭┱┭━┯┳┳━┭┳╦┙┥┪┥┵┽╅┽┷┿╈╈┵┽╈┽┛┩┫┫┹╃╉╉┻╇╋╋┻╇╋╋╝╣╣╣╨╫╫╫╩╬╬╬╩╬╬╬╴╕┓╗─┬┰╦━┮┳╦═╤╦╦╛╡┧╡┴┼╁┼┶┾╈┾╧╪╪╪┛┦┫┫┸╀╉╀┻╇╋╋┻╀╋╋╝╣╣╣╩╬╬╬╩╬╬╬╩╬╬╬ ╷╻╷╶╭┎╓╺┍┏┏◁╒╔╔╵│╽│╰├┟├┕┝┢┝╘╞╞╠╹╿┃┃┖┞┠┞┗┡┣┣╚╞╠╠╵│┃║╙├┟╟┗┝┣┣╚╠╠╠╴╮┒╖─┬┰╥╼┮┲┮═╤╦╦╯┤┧┤┴┼╁┼┶┾╆┾╧╪╪╬┚┦┨┦┸╀╂╀┺╄╊╊╩╪╬╬╜┤┧╢╨┼╁╫┶┾╊┾╩╬╬╬╸┑┓┓╾┭┱┭━┯┳┳═╤╦╦┙┥┪┥┵┽╅┽┷┿╈╈╧╪╪╬┛┩┫┫┹╃╉╉┻╇╋╋╩╪╬╬┛┥┫╣┵┽╉╫┻╇╋╋╩╬╬╬╴╕┓╗─┬┰╥━┮┳┳═╤╦╦╛╡┧╣┴┼╁┼┶┾╈┾╧╪╪╬┛┦┫╣┸╀╉╀┻╇╋╋╩╪╬╬╝╣╣╣╨┼╁╫┻┾╋╋╩╬╬╬ ╷╻△╶╭┎╓╺┍┏╔╶╒┏╔╵│╽║╰├┟╟┕┝┢╠╘╞┟╠╹╿┃║┖┞┠╟┗┡┣╠┗┞┣╠╵│┃║╙├┟╟┗┝┣╠╚╞┣╠╴╮┒╖─┬┰╥╼┮┲╥─┬┰╦╯┤┧╢┴┼╁╫┶┾╆╫┴┼╁╬┚┦┨╢┸╀╂╫┺╄╊╫┸╀╊╬╜┤┧╢╨┼╁╫┶┾╊╫╩┼╁╬╸┑┓╗╾┭┱╥━┯┳╦━┭┳╦┙┥┪╣┵┽╅╫┷┿╈╬┵┽╈╬┛┩┫╣┹╃╉╫┻╇╋╬┻╇╋╬┛┥┫╣┵┽╉╫┻╇╋╬╩┽╋╬╴╕┓╗─┬┰╦━┮┳╦═╤┳╦╛╡┧╣┴┼╁╬┶┾╈╬╧╪╁╬┛┦┫╣┸╀╉╬┻╇╋╬╩╪╋╬╝╡┫╣╩┼╁╬╩┾╋╬╩╪╋╬ ╷╻╷╶┌┎╓╺┍┏┏╶╒┏╔╵┊╽┊└├┟├┕┝┢┝╘╞┟╠╹╿┋┋┖┞┠┞┗┡┣┣┗┞┣╠╵┊┋║╙├┟╟┗┝┣╠╚╠╠╠╴┐┒╖┄┬┰╥╼┮┲┮┄┬┰╥┘┤┧┤┴┼╁┼┶┾╆┾┴┼╁┼┚┦┨┦┸╀╂╀┺╄╊╊┸╀╊╀╜┤┧╢╨┼╁╫┶┾╊╫╨┼╁╫╸┑┓┓╾┭┱┭┅┯┳┳┅┭┳┳┙┥┪┥┵┽╅┽┷┿╈╈┵┽╈┽┛┩┫┫┹╃╉╉┻╇╋╋┻╇╋╋┛┥┫┫┵┽╉┽┻╇╋╋┻┽╋╋▷╕╗╗═╤╦╦═╤╦╦═╤╦╦╛╡╡╣╧╪╪╬╧╪╪╬╧╪╪╬╝╡╣╣╩╪╬╬╩╪╬╬╩╪╬╬╝╣╣╣╩╬╬╬╩╬╬╬╩╬╬╬ ╷╻╷╶┌┎╓╺┍┏┏╶╒┏╔╵┊╽┊└├┟├┕┝┢┝╘╞┟╞╹╿┋┋┖┞┠┞┗┡┣┣┗┞┣┣▽║║║╙╟╟╟╚╠╠╠╚╠╠╠╴┐┒╖┄┬┰╥╼┮┲┮┄┬┰╦┘┤┧┤┴┼╁┼┶┾╆┾┴┼╁┼┚┦┨┦┸╀╂╀┺╄╊╊┸╀╊╀╜╢╢╢╨╫╫╫╨╫╫╫╩╬╬╬╸┑┓┓╾┭┱┭┅┯┳┳┅┭┳╦┙┥┪┥┵┽╅┽┷┿╈╈┵┽╈┽┛┩┫┫┹╃╉╉┻╇╋╋┻╇╋╋╝╣╣╣╨╫╫╫╩╬╬╬╩╬╬╬╴╕┓╗┄┬┰╦┅┮┳╦═╤╦╦╛╡┧╡┴┼╁┼┶┾╈┾╧╪╪╪┛┦┫┫┸╀╉╀┻╇╋╋┻╀╋╋╝╣╣╣╩╬╬╬╩╬╬╬╩╬╬╬ ╷╻╷╶┌┎╓╺┍┏┏◁╒╔╔╵┊╽┊└├┟├┕┝┢┝╘╞╞╠╹╿┋┋┖┞┠┞┗┡┣┣╚╞╠╠╵┊┋║╙├┟╟┗┝┣┣╚╠╠╠╴┐┒╖┄┬┰╥╼┮┲┮═╤╦╦┘┤┧┤┴┼╁┼┶┾╆┾╧╪╪╬┚┦┨┦┸╀╂╀┺╄╊╊╩╪╬╬╜┤┧╢╨┼╁╫┶┾╊┾╩╬╬╬╸┑┓┓╾┭┱┭┅┯┳┳═╤╦╦┙┥┪┥┵┽╅┽┷┿╈╈╧╪╪╬┛┩┫┫┹╃╉╉┻╇╋╋╩╪╬╬┛┥┫╣┵┽╉╫┻╇╋╋╩╬╬╬╴╕┓╗┄┬┰╥┅┮┳┳═╤╦╦╛╡┧╣┴┼╁┼┶┾╈┾╧╪╪╬┛┦┫╣┸╀╉╀┻╇╋╋╩╪╬╬╝╣╣╣╨┼╁╫┻┾╋╋╩╬╬╬ ╷╻△╶┌┎╓╺┍┏╔╶╒┏╔╵┊╽║└├┟╟┕┝┢╠╘╞┟╠╹╿┋║┖┞┠╟┗┡┣╠┗┞┣╠╵┊┋║╙├┟╟┗┝┣╠╚╞┣╠╴┐┒╖┄┬┰╥╼┮┲╥┄┬┰╦┘┤┧╢┴┼╁╫┶┾╆╫┴┼╁╬┚┦┨╢┸╀╂╫┺╄╊╫┸╀╊╬╜┤┧╢╨┼╁╫┶┾╊╫╩┼╁╬╸┑┓╗╾┭┱╥┅┯┳╦┅┭┳╦┙┥┪╣┵┽╅╫┷┿╈╬┵┽╈╬┛┩┫╣┹╃╉╫┻╇╋╬┻╇╋╬┛┥┫╣┵┽╉╫┻╇╋╬╩┽╋╬╴╕┓╗┄┬┰╦┅┮┳╦═╤┳╦╛╡┧╣┴┼╁╬┶┾╈╬╧╪╁╬┛┦┫╣┸╀╉╬┻╇╋╬╩╪╋╬╝╡┫╣╩┼╁╬╩┾╋╬╩╪╋╬";Draw.BestArrow=[[" ","►","▶","▷"],[" ","⍒","▼","▽"],[" ","◄","◀","◁"],[" ","⍋","▲","△"]];var Shadow=Shadow?Shadow:{};(function(a,d){var c=false;var b;var e="\u00A0";a.init=function(g){b=g;g.val("")};a.dream=function(j){if(b&&!c){var l=d.getCaret(j);var k=j.val();var g=k.split("\n");for(var h=0;h<g.length;h++){g[h]=Array(g[h].length+1).join(e)}b.val(k);b.scrollTop(j.scrollTop());b.scrollLeft(j.scrollLeft());j.val(g.join("\n"));d.setCaret(j,l);c=true}};a.wake=function(g){if(b&&c){var h=d.getCaret(g);g.val(f(b.val().split("\n"),g.val().split("\n")).join("\n"));d.setCaret(g,h);b.val("");c=false}};var f=function(n,h){for(var l=0;l<h.length;l++){var o=n[l];o=o?o:[];var g=h[l].replace(new RegExp(e+"+$"),"");if(g.length>o.length){o+=Array(g.length-o.length+1).join(" ")}if(!g.match(new RegExp("^"+e+"*$"))){var m=Array(o.length);for(var k=0;k<o.length;k++){m[k]=g[k]&&g[k]!=e?g[k]:o[k]}o=m.join("")}n[l]=o}return n}})(Shadow,Caret);var Drag=Drag?Drag:{};(function(k,i){var a=function(p){return p!=undefined};var c=function(p,r,q,s){return a(p[r])?(a(q)?(a(p[r][q])?p[r][q]:s):p[r]):(a(q)?s:[])};var m=function(p,r,q,s){if(!a(p[r])){p[r]=[]}p[r][q]=s};var b=function(p,q){return c(p,q.row,q.col," ")==" "?0:1};var o=function(p,u,t){var s=u.row;var q=u.col;var v=b(p,{col:q+[-1,-1,0,0][t],row:s+[1,0,0,1][t]});var r=b(p,{col:q+[-1,0,0,-1][t],row:s+[0,0,1,1][t]});return[[1,0],[1,-1]][v][r]};var g=function(J){var q=i.getCaret(J).start;var E=J.val().split("\n");var z=[];var A="L";var B="R";if(b(E,q)!=1){return false}for(var L=0;L<4;L++){z=[];var v=i.side(q,L);if(b(E,v)!=0){continue}var M={col:q.col+[0,1,1,0][L],row:q.row+[-1,-1,0,0][L]};var G=M.row;var D=M.col;var s=(L+1)%4;var x=0;var H=0;while((H<1||M.row!=G||M.col!=D)){var u=M.col+[0,-1,-1,0][s];var w=M.row+[1,1,0,0][s];var I=M.col+[0,0,-1,-1][s];var K=M.row+[0,1,1,0][s];if(!z[w]){z[w]=[]}z[w][u]=A;if(!z[K]){z[K]=[]}z[K][I]=B;var y=o(E,M,s);s=(s+y+4)%4;x+=y;M=i.side(M,s);H++}if(x<=0){continue}var r=new Array(z.length);for(var H=0;H<z.length;H++){var t=0;var p=c(z,H).length;var C=new Array(p);for(var F=0;F<p;F++){if(t&&z[H][F]==A||!t&&z[H][F]==B){t=!t}C[F]=t?E[H][F]:null}r[H]=C}return r}return false};var j={};var n=[];var h=[];var f={};var l=true;k.remember=function(q,p){p&&p.forEach(function(r){f[r]=true});if(l){j=i.getCaret(q).start;n=q.val().split("\n");h=g(q);l=false}};k.releaseFuncKey=function(p){if(f[p]){f={};l=true}};var e=function(D,w,r,x,C,y){var u=D.map(function(t){return t.length});for(var v=0;v<w.length;v++){u[v+r]=Math.max(c(u,v+r),c(w,v).length+x)}var p=new Array(u.length);for(var v=0;v<u.length;v++){p[v]=new Array(u[v]==null?0:u[v])}for(var v=0;v<D.length;v++){var q=c(D,v).length;for(var s=0;s<q;s++){m(p,v,s,c(w,v,s,null)==null?D[v][s]:" ")}}for(var v=0;v<w.length;v++){var q=c(w,v).length;for(var s=0;s<q;s++){var E=r+v;var B=x+s;if(w[v][s]!=null&&E>=0&&B>=0){m(p,E,B,C?y:w[v][s])}}}for(var v=0;v<p.length;v++){var A="";for(var s=0;s<c(p,v).length;s++){var z=c(p,v,s);A+=z==null?" ":z}p[v]=A}return p};k.HIGHLINE_CHAR="█";var d=false;k.unhighlight=function(p){if(d){p.val("");p.removeClass("highlight");d=false}};k.move=function(r,v,w){if(!h){return true}var t=i.getCaret(r,t);if(t.start.row!=t.end.row||t.start.col<t.end.col-1){return true}if(t.start.col==0&&v==0||t.start.row==0&&v==1){return false}var x=false;if(v==-1){v=4;x=true}var q=t.start.row-j.row+[0,-1,0,1,0][v];var u=t.start.col-j.col+[-1,0,1,0,0][v];var p=e(n,h,q,u,x," ");r.val(p.join("\n"));i.setCaret(r,{start:i.side(t.start,v),end:i.side(t.end,v)});if(w){var s=e(new Array(n.length),h,q,u,true,k.HIGHLINE_CHAR);w.val(s.join("\n"));w.addClass("highlight");w.scrollTop(r.scrollTop());w.scrollLeft(r.scrollLeft());d=true}return false}})(Drag,Caret);$(document).ready(function(){UI.t=$("#thearea");UI.x=$("#shadow");UI.updateStyle=function(){var a=$("#t-wrapper");if(UI.t.mode=="erase"){a.attr("class","erase")}else{if(UI.t.mode=="nothing"){a.attr("class","")}else{if(UI.t.arrow=="yes"){a.attr("class","arrow")}else{a.attr("class","draw")}}}};UI.groupInit("mode","mode",Draw.style,{regular:{val:Draw.REGULAR,next:"erase",t:""},bold:{val:Draw.BOLD,next:"erase",t:""},"double":{val:Draw.DOUBLE,next:"erase",t:""},erase:{val:Draw.BLANK,next:UI.LAST_CTRL,t:"erase"},nothing:{val:Draw.NOTHING,next:"nothing",t:"nothing"}});UI.groupInit("heart","heart",Draw.heart,{plain:{val:Draw.PLAIN,next:"round",t:""},round:{val:Draw.ROUND,next:"dashed",t:""},dashed:{val:Draw.DASHED,next:"plain",t:""}});UI.groupInit("arrow","arrow",Draw.arrow,{yes:{val:Draw.ARROW,next:"no",t:"yes"},no:{val:Draw.NO_ARROW,next:"yes",t:""}});UI.mode.ctrl("regular").click();UI.heart.ctrl("round").click();UI.arrow.ctrl("no").click();History.init()&&History.resume(UI.t);UI.t.attr("spellcheck",false);UI.x.attr("spellcheck",false);Shadow.init(UI.x);UI.t.keydown(function(a){if(Keys.equal(a,Keys.DIR)||Keys.equal(a,Keys.SHIFT_DIR)){Draw.extendArea(UI.t,a.which-37);if(Keys.equal(a,Keys.SHIFT_DIR)&&Draw.style.val!=Draw.NOTHING){return Draw.move(UI.t,a.which-37)}return true}if(Keys.equal(a,Keys.BACKSPACE)&&Draw.style.val!=Draw.NOTHING){return Draw.backspace(UI.t)}if(Keys.equal(a,Keys.META_SHIFT)){Drag.remember(UI.t,[16,91]);Drag.move(UI.t,4,UI.x);if(Keys.equal(a,Keys.META_SHIFT_DIR)){return Drag.move(UI.t,a.which-37,UI.x)}if(Keys.equal(a,Keys.META_SHIFT_BS)){Drag.unhighlight(UI.x);return Drag.move(UI.t,-1)}if(Keys.equal(a,Keys.META_SHIFT_Z)){Drag.unhighlight(UI.x);return History.redo(UI.t)}return true}if(Keys.equal(a,Keys.ALT)){UI.arrow.next.click();return true}if(Keys.equal(a,Keys.TAB)){UI.mode.next.click();return false}if(Keys.equal(a,Keys.META_Z)){return History.rewind(UI.t)}if((Keys.equal(a,Keys.NON_FUNC)||Keys.equal(a,Keys.META_V))&&Draw.style.val!=Draw.NOTHING){Shadow.dream(UI.t)}return true});UI.t.keyup(function(a){Shadow.wake(UI.t);Drag.releaseFuncKey(a.which);Drag.unhighlight(UI.x);History.record(UI.t)});$(window).unload(function(a){History.record(UI.t)})});